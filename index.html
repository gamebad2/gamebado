<!DOCTYPE html>
<html lang="fa" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="دانلود بهترین بازی‌های موبایلی با GameBad - اخبار، بررسی‌ها و پشتیبانی کامل">
    <meta name="keywords" content="دانلود بازی موبایل, بازی‌های پرطرفدار, پابجی, کندی کراش, فری فایر">
    <title>GameBad - دانلود بازی‌های موبایلی پرطرفدار</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&family=Bungee&family=Noto+Sans:wght@400;700&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.6/dist/purify.min.js"></script>
    <style>
        :root {
            --bg-color: linear-gradient(135deg, #1a1a1a 0%, #0d47a1 100%);
            --header-bg: rgba(13, 110, 253, 0.8);
            --card-bg: rgba(44, 44, 44, 0.9);
            --text-color: #fff;
            --btn-bg: #198754;
            --btn-hover: #0d6efd;
            --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            --popup-bg: rgba(44, 44, 44, 0.9);
            --form-bg: rgba(44, 44, 44, 0.95);
        }

        [data-theme="light"] {
            --bg-color: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            --header-bg: rgba(255, 255, 255, 0.9);
            --card-bg: rgba(255, 255, 255, 0.95);
            --text-color: #333;
            --btn-bg: #28a745;
            --btn-hover: #007bff;
            --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            --popup-bg: rgba(255, 255, 255, 0.95);
            --form-bg: rgba(255, 255, 255, 0.95);
        }

        body {
            font-family: 'Vazirmatn', 'Noto Sans', sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            text-align: right;
            min-height: 100vh;
            background-attachment: fixed;
            transition: background 0.3s ease, color 0.3s ease;
        }

        header {
            background: var(--header-bg);
            padding: 20px;
            text-align: center;
            border-radius: 12px;
            margin-bottom: 20px;
            animation: fadeIn 1s ease-in-out;
            position: relative;
            box-shadow: var(--card-shadow);
            z-index: 1000;
        }

        .logo {
            font-family: 'Bungee', sans-serif;
            font-size: 48px;
            color: #0d6efd;
            text-shadow: 0 0 5px #0d6efd, 0 0 10px #0d6efd;
            animation: neonGlow 3s ease-in-out infinite;
        }

        .new-message-notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #dc3545;
            color: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 9999;
            animation: fadeInOut 4s forwards;
            font-size: 1.1rem;
            text-align: center;
        }

        @keyframes fadeInOut {
            0% {
                opacity: 0;
                top: 0;
            }

            10% {
                opacity: 1;
                top: 20px;
            }

            90% {
                opacity: 1;
                top: 20px;
            }

            100% {
                opacity: 0;
                top: 0;
            }
        }

        .welcome-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 80vh;
            background: var(--form-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--card-shadow);
            animation: scaleUp 0.5s ease-in-out;
            text-align: center;
        }

        .welcome-section h2 {
            color: #0d6efd;
            margin-bottom: 20px;
            font-size: 28px;
        }

        .welcome-buttons {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .welcome-buttons button {
            background-color: var(--btn-bg);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }

        .welcome-buttons button:hover {
            background-color: var(--btn-hover);
        }

        .welcome-form {
            display: none;
            flex-direction: column;
            gap: 12px;
            width: 100%;
            max-width: 400px;
        }

        .welcome-form.active {
            display: flex;
        }

        .password-container {
            position: relative;
        }

        .password-container input {
            width: calc(100% - 30px);
        }

        .password-container .toggle-password {
            position: absolute;
            top: 50%;
            left: 10px;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-color);
            padding: 0;
        }

        .password-container .toggle-password svg {
            width: 20px;
            height: 20px;
            fill: var(--text-color);
        }

        .welcome-form input,
        .welcome-form select {
            padding: 10px;
            border-radius: 8px;
            border: none;
            background-color: rgba(44, 44, 44, 0.8);
            color: var(--text-color);
            font-size: 14px;
        }

        [data-theme="light"] .welcome-form input,
        [data-theme="light"] .welcome-form select {
            background-color: rgba(200, 200, 200, 0.8);
        }

        .welcome-form select {
            width: 100%;
        }

        .welcome-form p {
            font-size: 14px;
            color: #0d6efd;
        }

        .header-buttons {
            display: flex;
            gap: 10px;
            position: absolute;
            top: 20px;
            left: 20px;
        }

        .hamburger {
            background: none;
            border: none;
            color: var(--text-color);
            cursor: pointer;
            width: 40px;
            height: 40px;
            padding: 0;
            z-index: 1001;
        }

        .hamburger svg {
            width: 30px;
            height: 30px;
            fill: var(--text-color);
        }

        .hamburger.active svg {
            transform: rotate(90deg);
        }

        .nav-menu {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
        }

        .nav-menu button {
            background-color: var(--btn-bg);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .nav-menu button:hover {
            background-color: var(--btn-hover);
        }

        .nav-menu button.active {
            background-color: var(--btn-hover);
        }

        .nav-menu.active {
            display: flex;
            flex-direction: column;
            position: absolute;
            top: 70px;
            left: 0;
            background-color: var(--header-bg);
            width: 100%;
            padding: 20px;
            border-radius: 0 0 12px 12px;
            z-index: 1000;
            animation: slideDown 0.3s ease-in-out;
        }

        .notification-btn,
        .theme-toggle-btn,
        .user-menu-btn {
            background: none;
            border: none;
            color: var(--text-color);
            cursor: pointer;
            padding: 0;
            z-index: 1001;
        }

        .notification-btn svg,
        .theme-toggle-btn svg {
            width: 24px;
            height: 24px;
            fill: var(--text-color);
        }

        .user-menu-btn {
            font-size: 16px;
            font-family: 'Vazirmatn', sans-serif;
        }

        .notification-popup,
        .favorites-popup {
            display: none;
            position: fixed;
            top: 70px;
            left: 10px;
            background: var(--popup-bg);
            color: var(--text-color);
            border-radius: 12px;
            padding: 15px;
            max-width: 300px;
            z-index: 1001;
            animation: scaleUp 0.3s ease-in-out;
            box-shadow: var(--card-shadow);
        }

        .notification-popup.active,
        .favorites-popup.active {
            display: block;
        }

        .notification-item {
            padding: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        [data-theme="light"] .notification-item {
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .notification-item:last-child {
            border-bottom: none;
        }

        .user-menu {
            display: none;
            position: absolute;
            top: 50px;
            left: 10px;
            background: var(--popup-bg);
            border-radius: 8px;
            padding: 10px;
            z-index: 1001;
            animation: slideDown 0.3s ease-in-out;
            box-shadow: var(--card-shadow);
        }

        .user-menu.active {
            display: block;
        }

        .user-menu button {
            display: block;
            width: 100%;
            background: none;
            border: none;
            color: var(--text-color);
            padding: 8px;
            text-align: right;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .user-menu button:hover {
            background-color: var(--btn-hover);
            color: white;
            border-radius: 5px;
        }

        .admin-panel {
            display: none;
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            animation: fadeIn 1s ease-in-out;
            box-shadow: var(--card-shadow);
        }

        .admin-panel.active {
            display: block;
        }

        .admin-hamburger {
            background: none;
            border: none;
            color: var(--text-color);
            cursor: pointer;
            width: 40px;
            height: 40px;
            padding: 0;
            z-index: 1001;
            margin-bottom: 20px;
        }

        .admin-hamburger svg {
            width: 30px;
            height: 30px;
            fill: var(--text-color);
        }

        .admin-hamburger.active svg {
            transform: rotate(90deg);
        }

        .admin-nav-menu {
            display: none;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }

        .admin-nav-menu.active {
            display: flex;
        }

        .admin-nav-menu button {
            background-color: var(--btn-bg);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .admin-nav-menu button:hover {
            background-color: var(--btn-hover);
        }

        .admin-nav-menu button.active {
            background-color: var(--btn-hover);
        }

        .admin-content {
            display: none;
        }

        .admin-content.active {
            display: block;
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .admin-table th,
        .admin-table td {
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 10px;
            text-align: right;
        }

        [data-theme="light"] .admin-table th,
        [data-theme="light"] .admin-table td {
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .admin-table th {
            background-color: var(--btn-bg);
            color: white;
        }

        .admin-table button {
            background-color: #d81b60;
            color: white;
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            white-space: nowrap;
        }

        .admin-table button:hover {
            background-color: #b71c1c;
        }

        .admin-table button.unban {
            background-color: var(--btn-bg);
        }

        .admin-table button.unban:hover {
            background-color: var(--btn-hover);
        }

        .admin-table button.delete-user {
            background-color: #b71c1c;
        }

        .admin-table button.delete-user:hover {
            background-color: #7b1fa2;
        }

        #search {
            width: 100%;
            max-width: 600px;
            padding: 12px;
            margin: 10px auto;
            border-radius: 8px;
            border: none;
            font-size: 16px;
            background-color: rgba(44, 44, 44, 0.8);
            color: var(--text-color);
            display: block;
            transition: box-shadow 0.3s, background-color 0.3s;
        }

        [data-theme="light"] #search {
            background-color: rgba(200, 200, 200, 0.8);
        }

        #search:focus {
            box-shadow: 0 0 10px #0d6efd;
        }

        #search::placeholder {
            color: #aaa;
        }

        .filters,
        .favorite-filters {
            text-align: center;
            margin: 10px 0;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }

        .filter-btn,
        .favorite-filter-btn {
            background-color: var(--btn-bg);
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .filter-btn:hover,
        .favorite-filter-btn:hover {
            background-color: var(--btn-hover);
        }

        .filter-btn.active,
        .favorite-filter-btn.active {
            background-color: var(--btn-hover);
        }

        .section-title {
            color: #0d6efd;
            margin: 20px 0;
            font-size: 24px;
        }

        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            padding: 0 10px;
        }

        .game-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            box-shadow: var(--card-shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            opacity: 0;
            transform: translateX(-50px);
            animation: slideInLeft 0.6s ease-in-out forwards;
            z-index: 1;
        }

        .game-card:nth-child(even) {
            transform: translateX(50px);
            animation: slideInRight 0.6s ease-in-out forwards;
        }

        .game-card:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(13, 110, 253, 0.6);
        }

        .game-logo {
            width: 100px;
            height: 100px;
            display: block;
            margin: 0 auto 10px;
            border-radius: 50%;
            object-fit: contain;
        }

        .game-card h3 {
            color: #0d6efd;
            margin-bottom: 10px;
            font-size: 18px;
            text-align: center;
        }

        .game-card p {
            margin: 5px 0;
            font-size: 14px;
        }

        .download-btn {
            background-color: var(--btn-bg);
            color: white;
            padding: 8px 15px;
            text-decoration: none;
            border-radius: 8px;
            display: block;
            text-align: center;
            margin-top: 10px;
            font-size: 14px;
            transition: background-color 0.5s ease;
        }

        .download-btn:hover {
            background-color: var(--btn-hover);
        }

        .favorite-btn {
            background-color: #ffca28;
            color: #1a1a1a;
            padding: 8px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: block;
            text-align: center;
            margin-top: 10px;
            font-size: 14px;
            transition: background-color 0.3s;
        }

        .favorite-btn:hover {
            background-color: #ffb300;
        }

        .favorite-btn.active {
            background-color: #d81b60;
            color: white;
        }

        .comment-btn {
            background-color: #0288d1;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: block;
            text-align: center;
            margin-top: 10px;
            font-size: 14px;
            transition: background-color 0.3s;
        }

        .comment-btn:hover {
            background-color: #0277bd;
        }

        .comment-form {
            display: none;
            flex-direction: column;
            gap: 12px;
            margin-top: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }

        .comment-form input,
        .comment-form textarea {
            padding: 10px;
            border-radius: 8px;
            border: none;
            background-color: rgba(44, 44, 44, 0.8);
            color: var(--text-color);
        }

        [data-theme="light"] .comment-form input,
        [data-theme="light"] .comment-form textarea {
            background-color: rgba(200, 200, 200, 0.8);
        }

        .comment-form textarea {
            resize: vertical;
            min-height: 80px;
        }

        .comments-list {
            margin-top: 10px;
        }

        .comment-item {
            padding: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 14px;
        }

        [data-theme="light"] .comment-item {
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .comment-item:last-child {
            border-bottom: none;
        }

        .dashboard-content {
            display: none;
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            animation: fadeIn 1s ease-in-out;
            box-shadow: var(--card-shadow);
        }

        .dashboard-content.active {
            display: block;
        }

        .news-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }

        .news-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            transition: transform 0.3s ease;
            animation: slideInLeft 0.6s ease-in-out forwards;
        }

        .news-card:hover {
            transform: scale(1.03);
        }

        .support-form,
        .report-form {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-width: 500px;
            margin: 0 auto;
        }

        .support-form input,
        .support-form textarea,
        .report-form input,
        .report-form textarea {
            padding: 10px;
            border-radius: 8px;
            border: none;
            background-color: rgba(44, 44, 44, 0.8);
            color: var(--text-color);
        }

        [data-theme="light"] .support-form input,
        [data-theme="light"] .support-form textarea,
        [data-theme="light"] .report-form input,
        [data-theme="light"] .report-form textarea {
            background-color: rgba(200, 200, 200, 0.8);
        }

        .support-form textarea,
        .report-form textarea {
            resize: vertical;
            min-height: 100px;
        }

        .submit-btn {
            background-color: var(--btn-bg);
            color: white;
            padding: 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .submit-btn:hover {
            background-color: var(--btn-hover);
        }

        .about-section {
            text-align: center;
            max-width: 600px;
            margin: 0 auto;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            color: #aaa;
            font-size: 14px;
        }

        [data-theme="light"] footer {
            color: #555;
        }

        .site-info {
            text-align: center;
            margin-top: 20px;
            line-height: 1.5;
            color: #ddd;
        }

        [data-theme="light"] .site-info {
            color: #555;
        }

        .chat-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-width: 700px;
            margin: 0 auto;
        }

        .chat-container h3 {
            color: #0d6efd;
            margin: 0;
            font-size: 20px;
        }

        .chat-list {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
        }

        .chat-message {
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .chat-message.sent {
            background-color: #0d6efd;
            text-align: right;
        }

        .chat-message.received {
            background-color: #198754;
            text-align: left;
        }

        .chat-message.received:hover {
            background-color: #146e3b;
        }


        .chat-message strong {
            display: block;
            margin-bottom: 5px;
        }

        .new-message-form {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .new-message-form input,
        .new-message-form textarea {
            padding: 10px;
            border-radius: 8px;
            border: none;
            background-color: rgba(44, 44, 44, 0.8);
            color: var(--text-color);
        }

        [data-theme="light"] .new-message-form input,
        [data-theme="light"] .new-message-form textarea {
            background-color: rgba(200, 200, 200, 0.8);
        }

        .new-message-form textarea {
            resize: vertical;
            min-height: 80px;
        }


        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-50px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(50px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes scaleUp {
            from {
                opacity: 0;
                transform: scale(0.9);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes neonGlow {
            0% {
                text-shadow: 0 0 5px #0d6efd, 0 0 10px #0d6efd;
            }

            50% {
                text-shadow: 0 0 10px #0d6efd, 0 0 15px #0d6efd;
            }

            100% {
                text-shadow: 0 0 5px #0d6efd, 0 0 10px #0d6efd;
            }
        }

        .game-card:nth-child(1) {
            animation-delay: 0.1s;
        }

        .game-card:nth-child(2) {
            animation-delay: 0.2s;
        }

        .game-card:nth-child(3) {
            animation-delay: 0.3s;
        }

        .game-card:nth-child(4) {
            animation-delay: 0.4s;
        }

        .game-card:nth-child(5) {
            animation-delay: 0.5s;
        }

        @media (max-width: 600px) {

            .games-grid,
            .news-grid {
                grid-template-columns: 1fr;
            }

            .game-card,
            .news-card {
                padding: 12px;
            }

            .game-card h3,
            .news-card h3 {
                font-size: 16px;
            }

            .game-card p,
            .news-card p {
                font-size: 12px;
            }

            .download-btn,
            .submit-btn,
            .favorite-btn,
            .comment-btn {
                font-size: 12px;
                padding: 6px 12px;
            }

            header {
                padding: 15px;
            }

            .logo {
                font-size: 36px;
            }

            .game-logo {
                width: 80px;
                height: 80px;
            }

            .header-buttons {
                display: flex;
            }

            .nav-menu {
                display: none;
            }

            .nav-menu.active {
                display: flex;
            }

            .user-menu {
                width: 150px;
            }

            .welcome-section {
                padding: 15px;
            }

            .welcome-form {
                max-width: 100%;
            }
        }

        @media (min-width: 601px) and (max-width: 900px) {
            .games-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .news-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>

<body>
    <section class="welcome-section" id="welcome">
        <h1 class="logo">GameBad</h1>
        <p>بهترین مرجع دانلود بازی‌های موبایل</p>
        <div class="welcome-buttons">
            <button onclick="showLoginForm()">ورود</button>
            <button onclick="showRegisterForm()">ثبت‌نام</button>
        </div>
        <div class="welcome-form" id="login-form">
            <input type="text" id="login-username" placeholder="یوزرنیم">
            <div class="password-container">
                <input type="password" id="login-password" placeholder="رمز عبور">
                <button type="button" class="toggle-password" onclick="togglePasswordVisibility('login-password')">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M12 4.5C7 4.5 2.73 7.61 0 12c2.73 4.39 7 7.5 12 7.5s9.27-3.11 12-7.5c-2.73-4.39-7-7.5-12-7.5zM12 17.5c-4.41 0-8.24-2.82-10-6.5C3.76 8.32 7.59 5.5 12 5.5s8.24 2.82 10 6.5c-1.76 3.68-5.59 6.5-10 6.5z" />
                        <circle cx="12" cy="12" r="3" />
                    </svg>
                </button>
            </div>
            <button class="submit-btn" onclick="login()">ورود</button>
        </div>
        <div class="welcome-form" id="register-form">
            <input type="text" id="register-username" placeholder="یوزرنیم (فقط حروف انگلیسی و اعداد)">
            <input type="text" id="register-first-name" placeholder="نام">
            <input type="text" id="register-last-name" placeholder="نام خانوادگی">
            <div class="password-container">
                <input type="password" id="register-password" placeholder="رمز عبور (حداقل ۸ کاراکتر)">
                <button type="button" class="toggle-password" onclick="togglePasswordVisibility('register-password')">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M12 4.5C7 4.5 2.73 7.61 0 12c2.73 4.39 7 7.5 12 7.5s9.27-3.11 12-7.5c-2.73-4.39-7-7.5-12-7.5zM12 17.5c-4.41 0-8.24-2.82-10-6.5C3.76 8.32 7.59 5.5 12 5.5s8.24 2.82 10 6.5c-1.76 3.68-5.59 6.5-10 6.5z" />
                        <circle cx="12" cy="12" r="3" />
                    </svg>
                </button>
            </div>
            <p id="username-status"></p>
            <select id="favorite-game-1">
                <option value="">بازی مورد علاقه ۱</option>
            </select>
            <select id="favorite-game-2">
                <option value="">بازی مورد علاقه ۲</option>
            </select>
            <select id="favorite-game-3">
                <option value="">بازی مورد علاقه ۳</option>
            </select>
            <button class="submit-btn" onclick="register()">ثبت‌نام</button>
        </div>
        <div class="site-info">
            <p>این سایت توسط <strong>امیرحسین</strong> برای ارائه بهترین بازی‌ها به شما ساخته شده است.</p>
        </div>
    </section>

    <header id="main-header" style="display: none;">
        <h1 class="logo">GameBad</h1>
        <p>بهترین مرجع دانلود بازی‌های موبایلی - توسط امیرحسین</p>
        <div class="header-buttons">
            <button class="hamburger" aria-label="منو اصلی">
                <svg viewBox="0 0 24 24">
                    <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" />
                </svg>
            </button>
            <button class="notification-btn" aria-label="اعلانات">
                <svg viewBox="0 0 24 24">
                    <path
                        d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.1-1.6-5.8-4-6.8V4h-4v2.2C7.6 7.2 6 9.9 6 13v5l-2 2v1h16v-1l-2-2z" />
                </svg>
            </button>
            <button class="theme-toggle-btn" aria-label="تغییر تم">
                <svg viewBox="0 0 24 24">
                    <path
                        d="M12 3a9 9 0 1 0 9 9c0-.5-.1-1-.1-1.5-.4.2-.9.3-1.4.3-2.5 0-4.5-2-4.5-4.5 0-.5.1-1 .3-1.4-.5 0-1-.1-1.5-.1A9 9 0 0 0 12 3z" />
                </svg>
            </button>
            <button class="user-menu-btn" aria-label="منوی کاربر"></button>
        </div>
        <div class="notification-popup">
            <div class="notification-item">بازی جدید: اسفالت ۱۰ معرفی شد! - ۱۵ آبان ۱۴۰۴</div>
            <div class="notification-item">آپدیت پابجی: نقشه جدید اضافه شد - ۱۰ آبان ۱۴۰۴</div>
            <div class="notification-item">رویداد ویژه کندی کراش شروع شد - ۵ آبان ۱۴۰۴</div>
        </div>
        <div class="favorites-popup">
            <div class="favorites-list" id="favorites-list"></div>
            <button class="submit-btn" onclick="closeFavoritesPopup()">بستن</button>
        </div>
        <div class="user-menu">
            <button onclick="showEditProfile()">ویرایش پروفایل</button>
            <button onclick="showFavoriteGames()">دیدن بازی‌های مورد علاقه</button>
            <button onclick="logout()">خروج</button>
        </div>
        <div class="nav-menu">
            <button class="dashboard-btn active" data-section="home">خانه</button>
            <button class="dashboard-btn" data-section="news">اخبار</button>
            <button class="dashboard-btn" data-section="favorites">علاقه‌مندی‌ها</button>
            <button class="dashboard-btn" data-section="messages">پیام‌ها</button>
            <button class="dashboard-btn" data-section="support">پشتیبانی</button>
            <button class="dashboard-btn" data-section="report">گزارش مشکل</button>
            <button class="dashboard-btn" data-section="about">درباره ما</button>
        </div>
    </header>

    <main id="main-content" style="display: none;">
        <div class="dashboard-content active" id="home">
            <input type="text" id="search" placeholder="جستجوی بازی...">
            <div class="filters">
                <button class="filter-btn active" data-filter="all">همه</button>
                <button class="filter-btn" data-filter="action">اکشن</button>
                <button class="filter-btn" data-filter="puzzle">پازل</button>
                <button class="filter-btn" data-filter="strategy">استراتژی</button>
                <button class="filter-btn" data-filter="racing">ماشین‌سواری</button>
                <button class="filter-btn" data-filter="simulation">شبیه‌سازی</button>
            </div>
            <div class="games-grid" id="games-grid"></div>
        </div>

        <div class="dashboard-content" id="news">
            <h2 class="section-title">اخبار داغ بازی‌های موبایل</h2>
            <div class="news-grid" id="news-grid">
                <div class="news-card">
                    <h3>آپدیت بزرگ برای کالاف دیوتی موبایل</h3>
                    <p>آپدیت جدید فصل ۷ با کلی اسلحه و مود جدید منتشر شد!</p>
                </div>
                <div class="news-card">
                    <h3>فورتنایت به موبایل برگشت؟</h3>
                    <p>شایعاتی مبنی بر بازگشت فورتنایت به اپ استور و گوگل پلی در جریان است.</p>
                </div>
                <div class="news-card">
                    <h3>معرفی بازی جدید "Rogue Racing"</h3>
                    <p>یک بازی ماشین‌سواری جدید با گرافیک خیره‌کننده معرفی شد.</p>
                </div>
            </div>
        </div>

        <div class="dashboard-content" id="favorites">
            <h2 class="section-title">بازی‌های مورد علاقه شما</h2>
            <div class="favorite-filters">
                <button class="favorite-filter-btn active" data-filter="all">همه</button>
                <button class="favorite-filter-btn" data-filter="action">اکشن</button>
                <button class="favorite-filter-btn" data-filter="puzzle">پازل</button>
                <button class="favorite-filter-btn" data-filter="strategy">استراتژی</button>
                <button class="favorite-filter-btn" data-filter="racing">ماشین‌سواری</button>
                <button class="favorite-filter-btn" data-filter="simulation">شبیه‌سازی</button>
            </div>
            <div class="games-grid" id="favorite-games-grid">
                <p>هنوز بازی مورد علاقه‌ای اضافه نکرده‌اید.</p>
            </div>
        </div>

        <div class="dashboard-content" id="messages">
            <h2 class="section-title">پیام‌ها و چت</h2>
            <div class="chat-container">
                <div class="chat-list" id="chat-list">
                    <div class="chat-message received">
                        <strong>ادمین</strong>
                        <p>سلام. خوش آمدید! اگر سوالی دارید بپرسید.</p>
                    </div>
                </div>
                <form id="chat-form" class="new-message-form">
                    <input type="text" id="chat-message-input" placeholder="متن پیام شما...">
                    <button type="submit" class="submit-btn">ارسال</button>
                </form>
            </div>
        </div>

        <div class="dashboard-content" id="support">
            <h2 class="section-title">ارسال تیکت پشتیبانی</h2>
            <form id="support-form" class="support-form">
                <input type="text" id="support-subject" placeholder="موضوع">
                <textarea id="support-message" placeholder="پیام خود را اینجا بنویسید"></textarea>
                <button type="submit" class="submit-btn">ارسال</button>
            </form>
        </div>

        <div class="dashboard-content" id="report">
            <h2 class="section-title">گزارش مشکل</h2>
            <form id="report-form" class="report-form">
                <input type="text" id="report-game" placeholder="نام بازی">
                <textarea id="report-description" placeholder="توضیح مشکل"></textarea>
                <button type="submit" class="submit-btn">ارسال گزارش</button>
            </form>
        </div>

        <div class="dashboard-content" id="about">
            <h2 class="section-title">درباره GameBad</h2>
            <div class="about-section">
                <p>
                    GameBad یک مرجع تخصصی برای دانلود بازی‌های موبایلی است. ما در تلاشیم تا با ارائه بهترین و جدیدترین بازی‌ها،
                    تجربه‌ای لذت‌بخش را برای شما فراهم کنیم.
                </p>
                <p>
                    هدف ما ارائه محتوای باکیفیت، بررسی‌های دقیق و پشتیبانی کامل از کاربران است.
                </p>
                <p>
                    این سایت توسط <strong>امیرحسین</strong> ساخته شده است و امیدواریم از آن لذت ببرید.
                </p>
            </div>
        </div>

        <div class="dashboard-content" id="edit-profile">
            <h2 class="section-title">ویرایش پروفایل</h2>
            <form id="edit-profile-form" class="welcome-form active">
                <input type="text" id="edit-username" placeholder="یوزرنیم" disabled>
                <input type="text" id="edit-first-name" placeholder="نام">
                <input type="text" id="edit-last-name" placeholder="نام خانوادگی">
                <div class="password-container">
                    <input type="password" id="edit-password" placeholder="رمز عبور">
                    <button type="button" class="toggle-password" onclick="togglePasswordVisibility('edit-password')">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M12 4.5C7 4.5 2.73 7.61 0 12c2.73 4.39 7 7.5 12 7.5s9.27-3.11 12-7.5c-2.73-4.39-7-7.5-12-7.5zM12 17.5c-4.41 0-8.24-2.82-10-6.5C3.76 8.32 7.59 5.5 12 5.5s8.24 2.82 10 6.5c-1.76 3.68-5.59 6.5-10 6.5z" />
                            <circle cx="12" cy="12" r="3" />
                        </svg>
                    </button>
                </div>
                <button class="submit-btn" onclick="saveProfileChanges()">ذخیره تغییرات</button>
                <button class="submit-btn" onclick="cancelEditProfile()">انصراف</button>
            </form>
        </div>

        <div id="admin-panel" class="admin-panel">
            <h2 class="section-title">پنل مدیریت</h2>
            <button class="admin-hamburger" aria-label="منو ادمین">
                <svg viewBox="0 0 24 24">
                    <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" />
                </svg>
            </button>
            <div class="admin-nav-menu">
                <button class="admin-nav-btn active" data-admin-section="manage-users">مدیریت کاربران</button>
                <button class="admin-nav-btn" data-admin-section="manage-games">مدیریت بازی‌ها</button>
                <button class="admin-nav-btn" data-admin-section="manage-comments">مدیریت کامنت‌ها</button>
            </div>
            <div class="admin-content active" id="manage-users">
                <h3>مدیریت کاربران</h3>
                <input type="text" id="user-search" placeholder="جستجوی کاربر (یوزرنیم)">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>یوزرنیم</th>
                            <th>نام</th>
                            <th>نام خانوادگی</th>
                            <th>وضعیت</th>
                            <th>نقش</th>
                            <th>عملیات</th>
                        </tr>
                    </thead>
                    <tbody id="user-table-body">
                    </tbody>
                </table>
            </div>

            <div class="admin-content" id="manage-games">
                <h3>مدیریت بازی‌ها</h3>
                <form id="add-game-form" class="welcome-form active">
                    <input type="text" id="game-id" placeholder="ID بازی">
                    <input type="text" id="game-name" placeholder="نام بازی">
                    <input type="text" id="game-logo-url" placeholder="لینک لوگو">
                    <input type="text" id="game-genre" placeholder="ژانر">
                    <input type="text" id="game-description" placeholder="توضیحات">
                    <input type="text" id="game-download-url" placeholder="لینک دانلود">
                    <button type="submit" class="submit-btn">افزودن بازی</button>
                </form>
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>نام</th>
                            <th>ژانر</th>
                            <th>عملیات</th>
                        </tr>
                    </thead>
                    <tbody id="game-table-body">
                    </tbody>
                </table>
            </div>

            <div class="admin-content" id="manage-comments">
                <h3>مدیریت کامنت‌ها</h3>
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>یوزرنیم</th>
                            <th>بازی</th>
                            <th>متن کامنت</th>
                            <th>عملیات</th>
                        </tr>
                    </thead>
                    <tbody id="comment-table-body">
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <footer>
        <p>&copy; ۱۴۰۴ GameBad. کلیه حقوق محفوظ است.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const users = JSON.parse(localStorage.getItem('users')) || [];
            const games = JSON.parse(localStorage.getItem('games')) || [];
            const favorites = JSON.parse(localStorage.getItem('favorites')) || {};
            const comments = JSON.parse(localStorage.getItem('comments')) || [];
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));

            const welcomeSection = document.getElementById('welcome');
            const mainHeader = document.getElementById('main-header');
            const mainContent = document.getElementById('main-content');
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            const hamburgerBtn = document.querySelector('.hamburger');
            const navMenu = document.querySelector('.nav-menu');
            const userMenuBtn = document.querySelector('.user-menu-btn');
            const userMenu = document.querySelector('.user-menu');
            const notificationBtn = document.querySelector('.notification-btn');
            const notificationPopup = document.querySelector('.notification-popup');
            const themeToggleBtn = document.querySelector('.theme-toggle-btn');
            const searchInput = document.getElementById('search');
            const filterButtons = document.querySelectorAll('.filter-btn');
            const favoriteFilterButtons = document.querySelectorAll('.favorite-filter-btn');
            const gamesGrid = document.getElementById('games-grid');
            const favoriteGamesGrid = document.getElementById('favorite-games-grid');
            const chatForm = document.getElementById('chat-form');
            const chatList = document.getElementById('chat-list');
            const chatInput = document.getElementById('chat-message-input');
            const adminPanel = document.getElementById('admin-panel');
            const adminHamburger = document.querySelector('.admin-hamburger');
            const adminNavMenu = document.querySelector('.admin-nav-menu');
            const adminNavButtons = document.querySelectorAll('.admin-nav-btn');
            const userTableBody = document.getElementById('user-table-body');
            const gameTableBody = document.getElementById('game-table-body');
            const commentTableBody = document.getElementById('comment-table-body');
            const addGameForm = document.getElementById('add-game-form');
            const editProfileForm = document.getElementById('edit-profile-form');
            const favoriteGame1Select = document.getElementById('favorite-game-1');
            const favoriteGame2Select = document.getElementById('favorite-game-2');
            const favoriteGame3Select = document.getElementById('favorite-game-3');
            const notificationSound = new Audio('notification.mp3');

            const gameData = [
                { id: 1, name: 'پابجی موبایل', genre: 'action', description: 'یک بازی بتل رویال هیجان‌انگیز', logo: 'https://cdn.iconscout.com/icon/free/png-256/pubg-1-283401.png', downloadUrl: '#' },
                { id: 2, name: 'کندی کراش', genre: 'puzzle', description: 'بازی پازل اعتیادآور و جذاب', logo: 'https://cdn.iconscout.com/icon/free/png-256/candy-crush-saga-1-331190.png', downloadUrl: '#' },
                { id: 3, name: 'فری فایر', genre: 'action', description: 'نبرد ۱ به ۱۰۰، فقط برای زنده‌ماندن', logo: 'https://cdn.iconscout.com/icon/free/png-256/free-fire-1574510-1335029.png', downloadUrl: '#' },
                { id: 4, name: 'کلش اف کلنز', genre: 'strategy', description: 'دهکده خود را بسازید و به نبرد بروید', logo: 'https://cdn.iconscout.com/icon/free/png-256/clash-of-clans-3-226871.png', downloadUrl: '#' },
                { id: 5, name: 'آسفالت ۹', genre: 'racing', description: 'بهترین بازی ماشین‌سواری با گرافیک خیره‌کننده', logo: 'https://cdn.iconscout.com/icon/free/png-256/asphalt-1-316223.png', downloadUrl: '#' },
                { id: 6, name: 'ساب‌وی سرفرز', genre: 'action', description: 'فرار کنید و از موانع بگذرید', logo: 'https://cdn.iconscout.com/icon/free/png-256/subway-surfers-2-226868.png', downloadUrl: '#' },
                { id: 7, name: 'پی اس موبایل', genre: 'simulation', description: 'بازی فوتبال واقع‌گرایانه با تیم‌های محبوب', logo: 'https://cdn.iconscout.com/icon/free/png-256/pes-2423793-2022712.png', downloadUrl: '#' },
            ];

            function saveUsers() {
                localStorage.setItem('users', JSON.stringify(users));
            }

            function saveGames() {
                localStorage.setItem('games', JSON.stringify(games));
            }

            function saveFavorites() {
                localStorage.setItem('favorites', JSON.stringify(favorites));
            }

            function saveComments() {
                localStorage.setItem('comments', JSON.stringify(comments));
            }

            function setCurrentUser(user) {
                localStorage.setItem('currentUser', JSON.stringify(user));
            }

            function clearCurrentUser() {
                localStorage.removeItem('currentUser');
            }

            function renderGames(gameList, containerId) {
                const container = document.getElementById(containerId);
                container.innerHTML = '';
                if (gameList.length === 0) {
                    container.innerHTML = `<p>${containerId === 'games-grid' ? 'بازی‌ای با این مشخصات پیدا نشد.' : 'هنوز بازی مورد علاقه‌ای اضافه نکرده‌اید.'}</p>`;
                    return;
                }
                gameList.forEach(game => {
                    const isFavorite = currentUser && favorites[currentUser.username] && favorites[currentUser.username].includes(game.id);
                    const gameCard = document.createElement('div');
                    gameCard.className = 'game-card';
                    gameCard.innerHTML = `
                        <img src="${game.logo}" alt="${game.name} لوگو" class="game-logo">
                        <h3>${DOMPurify.sanitize(game.name)}</h3>
                        <p>ژانر: ${DOMPurify.sanitize(game.genre)}</p>
                        <p>${DOMPurify.sanitize(game.description)}</p>
                        <a href="${DOMPurify.sanitize(game.downloadUrl)}" class="download-btn">دانلود</a>
                        ${currentUser ? `<button class="favorite-btn ${isFavorite ? 'active' : ''}" data-game-id="${game.id}">${isFavorite ? 'حذف از علاقه‌مندی‌ها' : 'افزودن به علاقه‌مندی‌ها'}</button>` : ''}
                        ${currentUser ? `<button class="comment-btn" data-game-id="${game.id}">دیدن/ارسال کامنت</button>` : ''}
                        <div class="comment-section" id="comments-${game.id}" style="display: none;">
                            <div class="comments-list"></div>
                            <form class="comment-form" data-game-id="${game.id}">
                                <textarea placeholder="کامنت خود را بنویسید"></textarea>
                                <button type="submit" class="submit-btn">ارسال</button>
                            </form>
                        </div>
                    `;
                    container.appendChild(gameCard);
                });

                document.querySelectorAll('.favorite-btn').forEach(btn => {
                    btn.addEventListener('click', toggleFavorite);
                });
                document.querySelectorAll('.comment-btn').forEach(btn => {
                    btn.addEventListener('click', toggleCommentSection);
                });
                document.querySelectorAll('.comment-form').forEach(form => {
                    form.addEventListener('submit', submitComment);
                });
            }

            function renderComments(gameId, commentsContainer) {
                const gameComments = comments.filter(c => c.gameId === gameId);
                commentsContainer.innerHTML = '';
                if (gameComments.length === 0) {
                    commentsContainer.innerHTML = '<p>اولین کامنت را شما بگذارید.</p>';
                    return;
                }
                gameComments.forEach(c => {
                    const commentItem = document.createElement('div');
                    commentItem.className = 'comment-item';
                    commentItem.innerHTML = `<strong>${DOMPurify.sanitize(c.username)}</strong>: <p>${DOMPurify.sanitize(c.text)}</p>`;
                    commentsContainer.appendChild(commentItem);
                });
            }

            function toggleCommentSection(event) {
                const gameId = parseInt(event.target.dataset.gameId);
                const commentSection = document.getElementById(`comments-${gameId}`);
                commentSection.style.display = commentSection.style.display === 'block' ? 'none' : 'block';
                if (commentSection.style.display === 'block') {
                    const commentsList = commentSection.querySelector('.comments-list');
                    renderComments(gameId, commentsList);
                }
            }

            function submitComment(event) {
                event.preventDefault();
                const form = event.target;
                const gameId = parseInt(form.dataset.gameId);
                const textarea = form.querySelector('textarea');
                const commentText = textarea.value.trim();
                if (!commentText || !currentUser) {
                    return;
                }
                const newComment = {
                    id: comments.length > 0 ? comments[comments.length - 1].id + 1 : 1,
                    username: currentUser.username,
                    gameId: gameId,
                    text: commentText
                };
                comments.push(newComment);
                saveComments();
                textarea.value = '';

                const commentsList = document.getElementById(`comments-${gameId}`).querySelector('.comments-list');
                renderComments(gameId, commentsList);
                showNotification('کامنت شما با موفقیت ارسال شد!');
            }

            function toggleFavorite(event) {
                const gameId = parseInt(event.target.dataset.gameId);
                if (!currentUser) return;
                const userFavorites = favorites[currentUser.username] || [];
                const index = userFavorites.indexOf(gameId);
                if (index > -1) {
                    userFavorites.splice(index, 1);
                    event.target.classList.remove('active');
                    event.target.textContent = 'افزودن به علاقه‌مندی‌ها';
                    showNotification('بازی از علاقه‌مندی‌ها حذف شد.');
                } else {
                    userFavorites.push(gameId);
                    event.target.classList.add('active');
                    event.target.textContent = 'حذف از علاقه‌مندی‌ها';
                    showNotification('بازی به علاقه‌مندی‌ها اضافه شد.');
                }
                favorites[currentUser.username] = userFavorites;
                saveFavorites();
                renderFavorites();
            }

            function renderFavorites(filter = 'all') {
                if (!currentUser) {
                    favoriteGamesGrid.innerHTML = '<p>لطفاً وارد حساب کاربری خود شوید تا بازی‌های مورد علاقه‌تان را ببینید.</p>';
                    return;
                }
                const userFavorites = favorites[currentUser.username] || [];
                const favoriteGames = games.filter(game => userFavorites.includes(game.id));
                const filteredGames = filter === 'all' ? favoriteGames : favoriteGames.filter(game => game.genre === filter);
                renderGames(filteredGames, 'favorite-games-grid');
            }

            function showNotification(message) {
                const notification = document.createElement('div');
                notification.className = 'new-message-notification';
                notification.textContent = message;
                document.body.appendChild(notification);
                setTimeout(() => {
                    notification.remove();
                }, 4000);
            }

            function showDashboard() {
                welcomeSection.style.display = 'none';
                mainHeader.style.display = 'block';
                mainContent.style.display = 'block';
                document.getElementById('user-menu-btn').textContent = DOMPurify.sanitize(currentUser.username);
                renderGames(games, 'games-grid');
                renderFavorites();
                updateAdminPanelVisibility();
            }

            window.showLoginForm = function () {
                loginForm.classList.add('active');
                registerForm.classList.remove('active');
            };

            window.showRegisterForm = function () {
                loginForm.classList.remove('active');
                registerForm.classList.add('active');
                populateFavoriteGameSelects();
            };

            function populateFavoriteGameSelects() {
                const selects = [favoriteGame1Select, favoriteGame2Select, favoriteGame3Select];
                selects.forEach(select => {
                    select.innerHTML = `<option value="">بازی مورد علاقه</option>`;
                    gameData.forEach(game => {
                        const option = document.createElement('option');
                        option.value = game.id;
                        option.textContent = game.name;
                        select.appendChild(option);
                    });
                });
            }

            window.login = function () {
                const username = document.getElementById('login-username').value;
                const password = document.getElementById('login-password').value;
                const user = users.find(u => u.username === username && u.password === password);
                if (user) {
                    setCurrentUser(user);
                    showDashboard();
                    showNotification('با موفقیت وارد شدید!');
                } else {
                    alert('نام کاربری یا رمز عبور اشتباه است.');
                }
            };

            window.register = function () {
                const username = document.getElementById('register-username').value;
                const password = document.getElementById('register-password').value;
                const firstName = document.getElementById('register-first-name').value;
                const lastName = document.getElementById('register-last-name').value;
                const favGame1 = document.getElementById('favorite-game-1').value;
                const favGame2 = document.getElementById('favorite-game-2').value;
                const favGame3 = document.getElementById('favorite-game-3').value;

                if (!username || !password || !firstName || !lastName) {
                    alert('لطفاً تمام فیلدها را پر کنید.');
                    return;
                }

                if (!/^[a-zA-Z0-9]+$/.test(username)) {
                    alert('یوزرنیم باید فقط شامل حروف انگلیسی و اعداد باشد.');
                    return;
                }

                if (password.length < 8) {
                    alert('رمز عبور باید حداقل ۸ کاراکتر باشد.');
                    return;
                }

                if (users.some(u => u.username === username)) {
                    document.getElementById('username-status').textContent = 'این یوزرنیم قبلاً ثبت شده است.';
                    document.getElementById('username-status').style.color = 'red';
                    return;
                } else {
                    document.getElementById('username-status').textContent = '';
                }

                const newUser = {
                    username: username,
                    password: password,
                    firstName: firstName,
                    lastName: lastName,
                    role: 'user',
                    isBanned: false,
                    favoriteGames: [favGame1, favGame2, favGame3].filter(id => id !== '').map(id => parseInt(id))
                };

                users.push(newUser);
                saveUsers();
                setCurrentUser(newUser);

                favorites[newUser.username] = newUser.favoriteGames;
                saveFavorites();

                showDashboard();
                showNotification('ثبت‌نام با موفقیت انجام شد!');
            };

            window.logout = function () {
                clearCurrentUser();
                location.reload();
            };

            window.togglePasswordVisibility = function (id) {
                const input = document.getElementById(id);
                if (input.type === 'password') {
                    input.type = 'text';
                } else {
                    input.type = 'password';
                }
            };

            if (currentUser) {
                showDashboard();
            } else {
                welcomeSection.style.display = 'flex';
            }

            // Hamburger menu functionality
            hamburgerBtn.addEventListener('click', () => {
                navMenu.classList.toggle('active');
                hamburgerBtn.classList.toggle('active');
            });

            // User menu functionality
            userMenuBtn.addEventListener('click', () => {
                userMenu.classList.toggle('active');
            });

            // Notification popup functionality
            notificationBtn.addEventListener('click', () => {
                notificationPopup.classList.toggle('active');
            });

            // Theme toggle functionality
            themeToggleBtn.addEventListener('click', () => {
                const body = document.body;
                if (body.getAttribute('data-theme') === 'light') {
                    body.removeAttribute('data-theme');
                } else {
                    body.setAttribute('data-theme', 'light');
                }
            });

            // Switch dashboard sections
            document.querySelectorAll('.dashboard-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.dashboard-content').forEach(section => {
                        section.classList.remove('active');
                    });
                    document.querySelectorAll('.dashboard-btn').forEach(navBtn => {
                        navBtn.classList.remove('active');
                    });
                    document.getElementById(btn.dataset.section).classList.add('active');
                    btn.classList.add('active');
                    if (btn.dataset.section === 'favorites') {
                        renderFavorites();
                    }
                });
            });

            // Search functionality
            searchInput.addEventListener('keyup', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                const filteredGames = games.filter(game =>
                    game.name.toLowerCase().includes(searchTerm) ||
                    game.genre.toLowerCase().includes(searchTerm) ||
                    game.description.toLowerCase().includes(searchTerm)
                );
                renderGames(filteredGames, 'games-grid');
            });

            // Filter functionality
            filterButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    filterButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    const filter = btn.dataset.filter;
                    const filteredGames = filter === 'all' ? games : games.filter(game => game.genre === filter);
                    renderGames(filteredGames, 'games-grid');
                });
            });

            favoriteFilterButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    favoriteFilterButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    const filter = btn.dataset.filter;
                    renderFavorites(filter);
                });
            });

            // Chat functionality (simple in-memory)
            chatForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const messageText = chatInput.value.trim();
                if (messageText && currentUser) {
                    const messageElement = document.createElement('div');
                    messageElement.className = 'chat-message sent';
                    messageElement.innerHTML = `<p>${DOMPurify.sanitize(messageText)}</p>`;
                    chatList.appendChild(messageElement);
                    chatInput.value = '';
                    chatList.scrollTop = chatList.scrollHeight;
                }
            });

            // Support and Report Forms (dummy functionality)
            document.getElementById('support-form').addEventListener('submit', (e) => {
                e.preventDefault();
                alert('تیکت شما با موفقیت ارسال شد. به زودی پاسخ داده خواهد شد.');
                e.target.reset();
            });

            document.getElementById('report-form').addEventListener('submit', (e) => {
                e.preventDefault();
                alert('گزارش شما با موفقیت ارسال شد. از همکاری شما متشکریم.');
                e.target.reset();
            });

            // Admin Panel Functionality
            function updateAdminPanelVisibility() {
                if (currentUser && currentUser.role === 'admin') {
                    adminPanel.style.display = 'block';
                    renderUsersTable();
                    renderGamesTable();
                    renderCommentsTable();
                } else {
                    adminPanel.style.display = 'none';
                }
            }

            adminHamburger.addEventListener('click', () => {
                adminNavMenu.classList.toggle('active');
                adminHamburger.classList.toggle('active');
            });

            adminNavButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.admin-content').forEach(section => {
                        section.classList.remove('active');
                    });
                    document.querySelectorAll('.admin-nav-btn').forEach(navBtn => {
                        navBtn.classList.remove('active');
                    });
                    document.getElementById(btn.dataset.adminSection).classList.add('active');
                    btn.classList.add('active');
                });
            });

            function renderUsersTable() {
                userTableBody.innerHTML = '';
                const searchTerm = document.getElementById('user-search').value.toLowerCase();
                const filteredUsers = users.filter(user => user.username.toLowerCase().includes(searchTerm));
                filteredUsers.forEach(user => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${DOMPurify.sanitize(user.username)}</td>
                        <td>${DOMPurify.sanitize(user.firstName)}</td>
                        <td>${DOMPurify.sanitize(user.lastName)}</td>
                        <td>${user.isBanned ? 'بسته شده' : 'فعال'}</td>
                        <td>${user.role === 'admin' ? 'ادمین' : 'کاربر'}</td>
                        <td>
                            ${user.username !== currentUser.username ? `<button onclick="toggleBanUser('${user.username}')" class="${user.isBanned ? 'unban' : 'ban'}">${user.isBanned ? 'باز کردن' : 'بستن'}</button>` : ''}
                            ${user.username !== currentUser.username ? `<button onclick="deleteUser('${user.username}')" class="delete-user">حذف</button>` : ''}
                        </td>
                    `;
                    userTableBody.appendChild(row);
                });
            }

            document.getElementById('user-search').addEventListener('keyup', renderUsersTable);

            window.toggleBanUser = function (username) {
                const user = users.find(u => u.username === username);
                if (user) {
                    user.isBanned = !user.isBanned;
                    saveUsers();
                    showNotification(`کاربر ${user.username} با موفقیت ${user.isBanned ? 'بسته' : 'باز'} شد.`);
                    renderUsersTable();
                }
            };

            window.deleteUser = function (username) {
                if (confirm(`آیا مطمئن هستید که می‌خواهید کاربر ${username} را حذف کنید؟`)) {
                    const index = users.findIndex(u => u.username === username);
                    if (index > -1) {
                        users.splice(index, 1);
                        saveUsers();
                        showNotification(`کاربر ${username} با موفقیت حذف شد.`);
                        renderUsersTable();
                    }
                }
            };

            function renderGamesTable() {
                gameTableBody.innerHTML = '';
                games.forEach(game => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${DOMPurify.sanitize(game.name)}</td>
                        <td>${DOMPurify.sanitize(game.genre)}</td>
                        <td>
                            <button onclick="editGame(${game.id})">ویرایش</button>
                            <button onclick="deleteGame(${game.id})" class="delete-user">حذف</button>
                        </td>
                    `;
                    gameTableBody.appendChild(row);
                });
            }

            addGameForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const newGame = {
                    id: parseInt(document.getElementById('game-id').value),
                    name: document.getElementById('game-name').value,
                    logo: document.getElementById('game-logo-url').value,
                    genre: document.getElementById('game-genre').value,
                    description: document.getElementById('game-description').value,
                    downloadUrl: document.getElementById('game-download-url').value
                };
                if (games.some(g => g.id === newGame.id)) {
                    alert('بازی با این ID از قبل وجود دارد.');
                    return;
                }
                games.push(newGame);
                saveGames();
                renderGames(games, 'games-grid');
                renderGamesTable();
                showNotification('بازی با موفقیت اضافه شد.');
                e.target.reset();
            });

            window.deleteGame = function (gameId) {
                if (confirm('آیا مطمئن هستید که می‌خواهید این بازی را حذف کنید؟')) {
                    const index = games.findIndex(g => g.id === gameId);
                    if (index > -1) {
                        games.splice(index, 1);
                        saveGames();
                        renderGames(games, 'games-grid');
                        renderGamesTable();
                        showNotification('بازی با موفقیت حذف شد.');
                    }
                }
            };

            function renderCommentsTable() {
                commentTableBody.innerHTML = '';
                comments.forEach(comment => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${DOMPurify.sanitize(comment.username)}</td>
                        <td>${DOMPurify.sanitize(games.find(g => g.id === comment.gameId)?.name || 'ناشناس')}</td>
                        <td>${DOMPurify.sanitize(comment.text)}</td>
                        <td>
                            <button onclick="deleteComment(${comment.id})" class="delete-user">حذف</button>
                        </td>
                    `;
                    commentTableBody.appendChild(row);
                });
            }

            window.deleteComment = function (commentId) {
                if (confirm('آیا مطمئن هستید که می‌خواهید این کامنت را حذف کنید؟')) {
                    const index = comments.findIndex(c => c.id === commentId);
                    if (index > -1) {
                        comments.splice(index, 1);
                        saveComments();
                        renderCommentsTable();
                        showNotification('کامنت با موفقیت حذف شد.');
                    }
                }
            };

            window.showEditProfile = function () {
                document.querySelectorAll('.dashboard-content').forEach(section => {
                    section.classList.remove('active');
                });
                document.getElementById('edit-profile').classList.add('active');
                document.getElementById('edit-username').value = currentUser.username;
                document.getElementById('edit-first-name').value = currentUser.firstName;
                document.getElementById('edit-last-name').value = currentUser.lastName;
            };

            window.saveProfileChanges = function () {
                const newFirstName = document.getElementById('edit-first-name').value;
                const newLastName = document.getElementById('edit-last-name').value;
                const newPassword = document.getElementById('edit-password').value;

                currentUser.firstName = newFirstName;
                currentUser.lastName = newLastName;
                if (newPassword.trim() !== '') {
                    if (newPassword.length < 8) {
                        alert('رمز عبور باید حداقل ۸ کاراکتر باشد.');
                        return;
                    }
                    currentUser.password = newPassword;
                }
                const userIndex = users.findIndex(u => u.username === currentUser.username);
                if (userIndex > -1) {
                    users[userIndex] = currentUser;
                    saveUsers();
                    setCurrentUser(currentUser);
                    showNotification('پروفایل با موفقیت به‌روزرسانی شد.');
                    document.querySelector('.dashboard-btn[data-section="home"]').click();
                }
            };

            window.cancelEditProfile = function () {
                document.querySelector('.dashboard-btn[data-section="home"]').click();
            };

            window.showFavoriteGames = function () {
                const popup = document.querySelector('.favorites-popup');
                const list = document.getElementById('favorites-list');
                list.innerHTML = '';
                if (currentUser) {
                    const userFavorites = favorites[currentUser.username] || [];
                    if (userFavorites.length > 0) {
                        userFavorites.forEach(gameId => {
                            const game = games.find(g => g.id === gameId);
                            if (game) {
                                const item = document.createElement('div');
                                item.textContent = game.name;
                                list.appendChild(item);
                            }
                        });
                    } else {
                        list.textContent = 'شما هنوز بازی مورد علاقه‌ای ندارید.';
                    }
                } else {
                    list.textContent = 'لطفاً ابتدا وارد شوید.';
                }
                popup.classList.add('active');
            };

            window.closeFavoritesPopup = function () {
                document.querySelector('.favorites-popup').classList.remove('active');
            };

            // Initial setup
            if (games.length === 0) {
                gameData.forEach(game => games.push(game));
                saveGames();
            }

            if (!users.some(u => u.username === 'admin')) {
                users.push({
                    username: 'admin',
                    password: 'password123',
                    firstName: 'ادمین',
                    lastName: 'سایت',
                    role: 'admin',
                    isBanned: false
                });
                saveUsers();
            }

            // Populate favorite game dropdowns
            populateFavoriteGameSelects();
            renderGames(games, 'games-grid');
            if (currentUser) {
                updateAdminPanelVisibility();
            }
        });
    </script>
</body>

</html>